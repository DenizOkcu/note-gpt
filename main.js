"use strict";var t=require("obsidian"),e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},e(t,r)};function r(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}function n(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function c(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,c)}u((n=n.apply(t,e||[])).next())}))}function o(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}var i,a,c="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},u="object"==typeof document&&document.all,s={all:u,IS_HTMLDDA:void 0===u&&void 0!==u},f=s.all,l=s.IS_HTMLDDA?function(t){return"function"==typeof t||t===f}:function(t){return"function"==typeof t},p={},h=function(t){try{return!!t()}catch(t){return!0}},y=!h((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]})),d=function(t){return t&&t.Math===Math&&t},v=d("object"==typeof globalThis&&globalThis)||d("object"==typeof window&&window)||d("object"==typeof self&&self)||d("object"==typeof c&&c)||function(){return this}()||c||Function("return this")(),g=l,b=s.all,w=s.IS_HTMLDDA?function(t){return"object"==typeof t?null!==t:g(t)||t===b}:function(t){return"object"==typeof t?null!==t:g(t)},m=w,S=v.document,O=m(S)&&m(S.createElement),E=function(t){return O?S.createElement(t):{}},T=!y&&!h((function(){return 7!==Object.defineProperty(E("div"),"a",{get:function(){return 7}}).a})),A=y&&h((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),C=w,P=String,j=TypeError,R=function(t){if(C(t))return t;throw new j(P(t)+" is not an object")},I=!h((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),L=I,_=Function.prototype.call,x=L?_.bind(_):function(){return _.apply(_,arguments)},N=v,D=l,U=function(t,e){return arguments.length<2?(r=N[t],D(r)?r:void 0):N[t]&&N[t][e];var r},k=I,M=Function.prototype,F=M.call,G=k&&M.bind.bind(F,F),z=k?G:function(t){return function(){return F.apply(t,arguments)}},B=z({}.isPrototypeOf),K=v,V="undefined"!=typeof navigator&&String(navigator.userAgent)||"",Y=K.process,q=K.Deno,W=Y&&Y.versions||q&&q.version,H=W&&W.v8;H&&(a=(i=H.split("."))[0]>0&&i[0]<4?1:+(i[0]+i[1])),!a&&V&&(!(i=V.match(/Edge\/(\d+)/))||i[1]>=74)&&(i=V.match(/Chrome\/(\d+)/))&&(a=+i[1]);var J=a,$=h,X=v.String,Q=!!Object.getOwnPropertySymbols&&!$((function(){var t=Symbol("symbol detection");return!X(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&J&&J<41})),Z=Q&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,tt=U,et=l,rt=B,nt=Object,ot=Z?function(t){return"symbol"==typeof t}:function(t){var e=tt("Symbol");return et(e)&&rt(e.prototype,nt(t))},it=String,at=function(t){try{return it(t)}catch(t){return"Object"}},ct=l,ut=at,st=TypeError,ft=function(t){if(ct(t))return t;throw new st(ut(t)+" is not a function")},lt=function(t){return null==t},pt=ft,ht=lt,yt=x,dt=l,vt=w,gt=TypeError,bt={exports:{}},wt=v,mt=Object.defineProperty,St=function(t,e){try{mt(wt,t,{value:e,configurable:!0,writable:!0})}catch(r){wt[t]=e}return e},Ot=St,Et="__core-js_shared__",Tt=v[Et]||Ot(Et,{}),At=Tt;(bt.exports=function(t,e){return At[t]||(At[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.33.2",mode:"global",copyright:"Â© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.33.2/LICENSE",source:"https://github.com/zloirock/core-js"});var Ct=bt.exports,Pt=lt,jt=TypeError,Rt=function(t){if(Pt(t))throw new jt("Can't call method on "+t);return t},It=Rt,Lt=Object,_t=function(t){return Lt(It(t))},xt=_t,Nt=z({}.hasOwnProperty),Dt=Object.hasOwn||function(t,e){return Nt(xt(t),e)},Ut=z,kt=0,Mt=Math.random(),Ft=Ut(1..toString),Gt=function(t){return"Symbol("+(void 0===t?"":t)+")_"+Ft(++kt+Mt,36)},zt=Ct,Bt=Dt,Kt=Gt,Vt=Q,Yt=Z,qt=v.Symbol,Wt=zt("wks"),Ht=Yt?qt.for||qt:qt&&qt.withoutSetter||Kt,Jt=function(t){return Bt(Wt,t)||(Wt[t]=Vt&&Bt(qt,t)?qt[t]:Ht("Symbol."+t)),Wt[t]},$t=x,Xt=w,Qt=ot,Zt=function(t,e){var r=t[e];return ht(r)?void 0:pt(r)},te=function(t,e){var r,n;if("string"===e&&dt(r=t.toString)&&!vt(n=yt(r,t)))return n;if(dt(r=t.valueOf)&&!vt(n=yt(r,t)))return n;if("string"!==e&&dt(r=t.toString)&&!vt(n=yt(r,t)))return n;throw new gt("Can't convert object to primitive value")},ee=TypeError,re=Jt("toPrimitive"),ne=function(t,e){if(!Xt(t)||Qt(t))return t;var r,n=Zt(t,re);if(n){if(void 0===e&&(e="default"),r=$t(n,t,e),!Xt(r)||Qt(r))return r;throw new ee("Can't convert object to primitive value")}return void 0===e&&(e="number"),te(t,e)},oe=ne,ie=ot,ae=function(t){var e=oe(t,"string");return ie(e)?e:e+""},ce=y,ue=T,se=A,fe=R,le=ae,pe=TypeError,he=Object.defineProperty,ye=Object.getOwnPropertyDescriptor,de="enumerable",ve="configurable",ge="writable";p.f=ce?se?function(t,e,r){if(fe(t),e=le(e),fe(r),"function"==typeof t&&"prototype"===e&&"value"in r&&ge in r&&!r[ge]){var n=ye(t,e);n&&n[ge]&&(t[e]=r.value,r={configurable:ve in r?r[ve]:n[ve],enumerable:de in r?r[de]:n[de],writable:!1})}return he(t,e,r)}:he:function(t,e,r){if(fe(t),e=le(e),fe(r),ue)try{return he(t,e,r)}catch(t){}if("get"in r||"set"in r)throw new pe("Accessors not supported");return"value"in r&&(t[e]=r.value),t};var be={exports:{}},we=y,me=Dt,Se=Function.prototype,Oe=we&&Object.getOwnPropertyDescriptor,Ee=me(Se,"name"),Te={EXISTS:Ee,PROPER:Ee&&"something"===function(){}.name,CONFIGURABLE:Ee&&(!we||we&&Oe(Se,"name").configurable)},Ae=l,Ce=Tt,Pe=z(Function.toString);Ae(Ce.inspectSource)||(Ce.inspectSource=function(t){return Pe(t)});var je,Re,Ie,Le=Ce.inspectSource,_e=l,xe=v.WeakMap,Ne=_e(xe)&&/native code/.test(String(xe)),De=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},Ue=p,ke=De,Me=y?function(t,e,r){return Ue.f(t,e,ke(1,r))}:function(t,e,r){return t[e]=r,t},Fe=Gt,Ge=Ct("keys"),ze=function(t){return Ge[t]||(Ge[t]=Fe(t))},Be={},Ke=Ne,Ve=v,Ye=w,qe=Me,We=Dt,He=Tt,Je=ze,$e=Be,Xe="Object already initialized",Qe=Ve.TypeError,Ze=Ve.WeakMap;if(Ke||He.state){var tr=He.state||(He.state=new Ze);tr.get=tr.get,tr.has=tr.has,tr.set=tr.set,je=function(t,e){if(tr.has(t))throw new Qe(Xe);return e.facade=t,tr.set(t,e),e},Re=function(t){return tr.get(t)||{}},Ie=function(t){return tr.has(t)}}else{var er=Je("state");$e[er]=!0,je=function(t,e){if(We(t,er))throw new Qe(Xe);return e.facade=t,qe(t,er,e),e},Re=function(t){return We(t,er)?t[er]:{}},Ie=function(t){return We(t,er)}}var rr={set:je,get:Re,has:Ie,enforce:function(t){return Ie(t)?Re(t):je(t,{})},getterFor:function(t){return function(e){var r;if(!Ye(e)||(r=Re(e)).type!==t)throw new Qe("Incompatible receiver, "+t+" required");return r}}},nr=z,or=h,ir=l,ar=Dt,cr=y,ur=Te.CONFIGURABLE,sr=Le,fr=rr.enforce,lr=rr.get,pr=String,hr=Object.defineProperty,yr=nr("".slice),dr=nr("".replace),vr=nr([].join),gr=cr&&!or((function(){return 8!==hr((function(){}),"length",{value:8}).length})),br=String(String).split("String"),wr=be.exports=function(t,e,r){"Symbol("===yr(pr(e),0,7)&&(e="["+dr(pr(e),/^Symbol\(([^)]*)\)/,"$1")+"]"),r&&r.getter&&(e="get "+e),r&&r.setter&&(e="set "+e),(!ar(t,"name")||ur&&t.name!==e)&&(cr?hr(t,"name",{value:e,configurable:!0}):t.name=e),gr&&r&&ar(r,"arity")&&t.length!==r.arity&&hr(t,"length",{value:r.arity});try{r&&ar(r,"constructor")&&r.constructor?cr&&hr(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var n=fr(t);return ar(n,"source")||(n.source=vr(br,"string"==typeof e?e:"")),t};Function.prototype.toString=wr((function(){return ir(this)&&lr(this).source||sr(this)}),"toString");var mr=be.exports,Sr=l,Or=p,Er=mr,Tr=St,Ar=function(t,e,r,n){n||(n={});var o=n.enumerable,i=void 0!==n.name?n.name:e;if(Sr(r)&&Er(r,i,n),n.global)o?t[e]=r:Tr(e,r);else{try{n.unsafe?t[e]&&(o=!0):delete t[e]}catch(t){}o?t[e]=r:Or.f(t,e,{value:r,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return t},Cr={};Cr[Jt("toStringTag")]="z";var Pr="[object z]"===String(Cr),jr=z,Rr=jr({}.toString),Ir=jr("".slice),Lr=function(t){return Ir(Rr(t),8,-1)},_r=Pr,xr=l,Nr=Lr,Dr=Jt("toStringTag"),Ur=Object,kr="Arguments"===Nr(function(){return arguments}()),Mr=_r?Nr:function(t){var e,r,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch(t){}}(e=Ur(t),Dr))?r:kr?Nr(e):"Object"===(n=Nr(e))&&xr(e.callee)?"Arguments":n},Fr=Mr,Gr=String,zr=function(t){if("Symbol"===Fr(t))throw new TypeError("Cannot convert a Symbol value to a string");return Gr(t)},Br=TypeError,Kr=function(t,e){if(t<e)throw new Br("Not enough arguments");return t},Vr=Ar,Yr=z,qr=zr,Wr=Kr,Hr=URLSearchParams,Jr=Hr.prototype,$r=Yr(Jr.append),Xr=Yr(Jr.delete),Qr=Yr(Jr.forEach),Zr=Yr([].push),tn=new Hr("a=1&a=2&b=3");tn.delete("a",1),tn.delete("b",void 0),tn+""!="a=2"&&Vr(Jr,"delete",(function(t){var e=arguments.length,r=e<2?void 0:arguments[1];if(e&&void 0===r)return Xr(this,t);var n=[];Qr(this,(function(t,e){Zr(n,{key:e,value:t})})),Wr(e,1);for(var o,i=qr(t),a=qr(r),c=0,u=0,s=!1,f=n.length;c<f;)o=n[c++],s||o.key===i?(s=!0,Xr(this,o.key)):u++;for(;u<f;)(o=n[u++]).key===i&&o.value===a||$r(this,o.key,o.value)}),{enumerable:!0,unsafe:!0});var en=Ar,rn=z,nn=zr,on=Kr,an=URLSearchParams,cn=an.prototype,un=rn(cn.getAll),sn=rn(cn.has),fn=new an("a=1");!fn.has("a",2)&&fn.has("a",void 0)||en(cn,"has",(function(t){var e=arguments.length,r=e<2?void 0:arguments[1];if(e&&void 0===r)return sn(this,t);var n=un(this,t);on(e,1);for(var o=nn(r),i=0;i<n.length;)if(n[i++]===o)return!0;return!1}),{enumerable:!0,unsafe:!0});var ln=mr,pn=p,hn=function(t,e,r){return r.get&&ln(r.get,e,{getter:!0}),r.set&&ln(r.set,e,{setter:!0}),pn.f(t,e,r)},yn=y,dn=z,vn=hn,gn=URLSearchParams.prototype,bn=dn(gn.forEach);yn&&!("size"in gn)&&vn(gn,"size",{get:function(){var t=0;return bn(this,(function(){t++})),t},configurable:!0,enumerable:!0});var wn={},mn={},Sn={}.propertyIsEnumerable,On=Object.getOwnPropertyDescriptor,En=On&&!Sn.call({1:2},1);mn.f=En?function(t){var e=On(this,t);return!!e&&e.enumerable}:Sn;var Tn=h,An=Lr,Cn=Object,Pn=z("".split),jn=Tn((function(){return!Cn("z").propertyIsEnumerable(0)}))?function(t){return"String"===An(t)?Pn(t,""):Cn(t)}:Cn,Rn=Rt,In=function(t){return jn(Rn(t))},Ln=y,_n=x,xn=mn,Nn=De,Dn=In,Un=ae,kn=Dt,Mn=T,Fn=Object.getOwnPropertyDescriptor;wn.f=Ln?Fn:function(t,e){if(t=Dn(t),e=Un(e),Mn)try{return Fn(t,e)}catch(t){}if(kn(t,e))return Nn(!_n(xn.f,t,e),t[e])};var Gn={},zn=Math.ceil,Bn=Math.floor,Kn=Math.trunc||function(t){var e=+t;return(e>0?Bn:zn)(e)},Vn=function(t){var e=+t;return e!=e||0===e?0:Kn(e)},Yn=Vn,qn=Math.max,Wn=Math.min,Hn=Vn,Jn=Math.min,$n=function(t){return t>0?Jn(Hn(t),9007199254740991):0},Xn=function(t){return $n(t.length)},Qn=In,Zn=function(t,e){var r=Yn(t);return r<0?qn(r+e,0):Wn(r,e)},to=Xn,eo=function(t){return function(e,r,n){var o,i=Qn(e),a=to(i),c=Zn(n,a);if(t&&r!=r){for(;a>c;)if((o=i[c++])!=o)return!0}else for(;a>c;c++)if((t||c in i)&&i[c]===r)return t||c||0;return!t&&-1}},ro={includes:eo(!0),indexOf:eo(!1)},no=Dt,oo=In,io=ro.indexOf,ao=Be,co=z([].push),uo=function(t,e){var r,n=oo(t),o=0,i=[];for(r in n)!no(ao,r)&&no(n,r)&&co(i,r);for(;e.length>o;)no(n,r=e[o++])&&(~io(i,r)||co(i,r));return i},so=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"].concat("length","prototype");Gn.f=Object.getOwnPropertyNames||function(t){return uo(t,so)};var fo={};fo.f=Object.getOwnPropertySymbols;var lo=U,po=Gn,ho=fo,yo=R,vo=z([].concat),go=lo("Reflect","ownKeys")||function(t){var e=po.f(yo(t)),r=ho.f;return r?vo(e,r(t)):e},bo=Dt,wo=go,mo=wn,So=p,Oo=h,Eo=l,To=/#|\.prototype\./,Ao=function(t,e){var r=Po[Co(t)];return r===Ro||r!==jo&&(Eo(e)?Oo(e):!!e)},Co=Ao.normalize=function(t){return String(t).replace(To,".").toLowerCase()},Po=Ao.data={},jo=Ao.NATIVE="N",Ro=Ao.POLYFILL="P",Io=Ao,Lo=v,_o=wn.f,xo=Me,No=Ar,Do=St,Uo=function(t,e,r){for(var n=wo(e),o=So.f,i=mo.f,a=0;a<n.length;a++){var c=n[a];bo(t,c)||r&&bo(r,c)||o(t,c,i(e,c))}},ko=Io,Mo=h,Fo=y,Go=Jt("iterator"),zo=!Mo((function(){var t=new URL("b?a=1&b=2&c=3","http://a"),e=t.searchParams,r=new URLSearchParams("a=1&a=2&b=3"),n="";return t.pathname="c%20d",e.forEach((function(t,r){e.delete("b"),n+=r+t})),r.delete("a",2),r.delete("b",void 0),!e.size&&!Fo||!e.sort||"http://a/c%20d?a=1&c=3"!==t.href||"3"!==e.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!e[Go]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://ÑÐµÑÑ").host||"#%D0%B1"!==new URL("http://a#Ð±").hash||"a1c3"!==n||"x"!==new URL("http://x",void 0).host})),Bo=function(t,e){var r,n,o,i,a,c=t.target,u=t.global,s=t.stat;if(r=u?Lo:s?Lo[c]||Do(c,{}):(Lo[c]||{}).prototype)for(n in e){if(i=e[n],o=t.dontCallGetSet?(a=_o(r,n))&&a.value:r[n],!ko(u?n:c+(s?".":"#")+n,t.forced)&&void 0!==o){if(typeof i==typeof o)continue;Uo(i,o)}(t.sham||o&&o.sham)&&xo(i,"sham",!0),No(r,n,i,t)}},Ko=h,Vo=Kr,Yo=zr,qo=zo,Wo=U("URL");Bo({target:"URL",stat:!0,forced:!(qo&&Ko((function(){Wo.canParse()})))},{canParse:function(t){var e=Vo(arguments.length,1),r=Yo(t),n=e<2||void 0===arguments[1]?void 0:Yo(arguments[1]);try{return!!new Wo(r,n)}catch(t){return!1}}});var Ho,Jo,$o,Xo=Xn,Qo="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Zo=!h((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),ti=Dt,ei=l,ri=_t,ni=Zo,oi=ze("IE_PROTO"),ii=Object,ai=ii.prototype,ci=ni?ii.getPrototypeOf:function(t){var e=ri(t);if(ti(e,oi))return e[oi];var r=e.constructor;return ei(r)&&e instanceof r?r.prototype:e instanceof ii?ai:null},ui=z,si=ft,fi=l,li=String,pi=TypeError,hi=function(t,e,r){try{return ui(si(Object.getOwnPropertyDescriptor(t,e)[r]))}catch(t){}},yi=R,di=function(t){if("object"==typeof t||fi(t))return t;throw new pi("Can't set "+li(t)+" as a prototype")},vi=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,r={};try{(t=hi(Object.prototype,"__proto__","set"))(r,[]),e=r instanceof Array}catch(t){}return function(r,n){return yi(r),di(n),e?t(r,n):r.__proto__=n,r}}():void 0),gi=Qo,bi=y,wi=v,mi=l,Si=w,Oi=Dt,Ei=Mr,Ti=at,Ai=Me,Ci=Ar,Pi=hn,ji=B,Ri=ci,Ii=vi,Li=Jt,_i=Gt,xi=rr.enforce,Ni=rr.get,Di=wi.Int8Array,Ui=Di&&Di.prototype,ki=wi.Uint8ClampedArray,Mi=ki&&ki.prototype,Fi=Di&&Ri(Di),Gi=Ui&&Ri(Ui),zi=Object.prototype,Bi=wi.TypeError,Ki=Li("toStringTag"),Vi=_i("TYPED_ARRAY_TAG"),Yi="TypedArrayConstructor",qi=gi&&!!Ii&&"Opera"!==Ei(wi.opera),Wi=!1,Hi={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Ji={BigInt64Array:8,BigUint64Array:8},$i=function(t){var e=Ri(t);if(Si(e)){var r=Ni(e);return r&&Oi(r,Yi)?r[Yi]:$i(e)}},Xi=function(t){if(!Si(t))return!1;var e=Ei(t);return Oi(Hi,e)||Oi(Ji,e)};for(Ho in Hi)($o=(Jo=wi[Ho])&&Jo.prototype)?xi($o)[Yi]=Jo:qi=!1;for(Ho in Ji)($o=(Jo=wi[Ho])&&Jo.prototype)&&(xi($o)[Yi]=Jo);if((!qi||!mi(Fi)||Fi===Function.prototype)&&(Fi=function(){throw new Bi("Incorrect invocation")},qi))for(Ho in Hi)wi[Ho]&&Ii(wi[Ho],Fi);if((!qi||!Gi||Gi===zi)&&(Gi=Fi.prototype,qi))for(Ho in Hi)wi[Ho]&&Ii(wi[Ho].prototype,Gi);if(qi&&Ri(Mi)!==Gi&&Ii(Mi,Gi),bi&&!Oi(Gi,Ki))for(Ho in Wi=!0,Pi(Gi,Ki,{configurable:!0,get:function(){return Si(this)?this[Vi]:void 0}}),Hi)wi[Ho]&&Ai(wi[Ho],Vi,Ho);var Qi={NATIVE_ARRAY_BUFFER_VIEWS:qi,TYPED_ARRAY_TAG:Wi&&Vi,aTypedArray:function(t){if(Xi(t))return t;throw new Bi("Target is not a typed array")},aTypedArrayConstructor:function(t){if(mi(t)&&(!Ii||ji(Fi,t)))return t;throw new Bi(Ti(t)+" is not a typed array constructor")},exportTypedArrayMethod:function(t,e,r,n){if(bi){if(r)for(var o in Hi){var i=wi[o];if(i&&Oi(i.prototype,t))try{delete i.prototype[t]}catch(r){try{i.prototype[t]=e}catch(t){}}}Gi[t]&&!r||Ci(Gi,t,r?e:qi&&Ui[t]||e,n)}},exportTypedArrayStaticMethod:function(t,e,r){var n,o;if(bi){if(Ii){if(r)for(n in Hi)if((o=wi[n])&&Oi(o,t))try{delete o[t]}catch(t){}if(Fi[t]&&!r)return;try{return Ci(Fi,t,r?e:qi&&Fi[t]||e)}catch(t){}}for(n in Hi)!(o=wi[n])||o[t]&&!r||Ci(o,t,e)}},getTypedArrayConstructor:$i,isView:function(t){if(!Si(t))return!1;var e=Ei(t);return"DataView"===e||Oi(Hi,e)||Oi(Ji,e)},isTypedArray:Xi,TypedArray:Fi,TypedArrayPrototype:Gi},Zi=function(t,e){for(var r=Xo(t),n=new e(r),o=0;o<r;o++)n[o]=t[r-o-1];return n},ta=Qi.aTypedArray,ea=Qi.getTypedArrayConstructor;(0,Qi.exportTypedArrayMethod)("toReversed",(function(){return Zi(ta(this),ea(this))}));var ra=Xn,na=ft,oa=function(t,e){for(var r=0,n=ra(e),o=new t(n);n>r;)o[r]=e[r++];return o},ia=Qi.aTypedArray,aa=Qi.getTypedArrayConstructor,ca=Qi.exportTypedArrayMethod,ua=z(Qi.TypedArrayPrototype.sort);ca("toSorted",(function(t){void 0!==t&&na(t);var e=ia(this),r=oa(aa(e),e);return ua(r,t)}));var sa=Xn,fa=Vn,la=RangeError,pa=Mr,ha=ne,ya=TypeError,da=function(t,e,r,n){var o=sa(t),i=fa(r),a=i<0?o+i:i;if(a>=o||a<0)throw new la("Incorrect index");for(var c=new e(o),u=0;u<o;u++)c[u]=u===a?n:t[u];return c},va=function(t){var e=pa(t);return"BigInt64Array"===e||"BigUint64Array"===e},ga=Vn,ba=function(t){var e=ha(t,"number");if("number"==typeof e)throw new ya("Can't convert number to bigint");return BigInt(e)},wa=Qi.aTypedArray,ma=Qi.getTypedArrayConstructor,Sa=Qi.exportTypedArrayMethod,Oa=!!function(){try{new Int8Array(1).with(2,{valueOf:function(){throw 8}})}catch(t){return 8===t}}();function Ea(){let t;return function*(e){for(t=void 0===t?e:function(t,e){const r=new Uint8Array(t.length+e.length);return r.set(t),r.set(e,t.length),r}(t,e);t&&t.length;){const e=t.findIndex((t=>[Ta.NewLine,Ta.CarriageReturn].includes(t)));if(!(-1!==e))break;const r=t[e]===Ta.CarriageReturn&&t[e+1]===Ta.NewLine?e+1:e,n=t.findIndex((t=>[Ta.Colon].includes(t))),o=-1!==n&&n<e?n:e;yield[t.subarray(0,e),o],t=t.subarray(r+1)}}}Sa("with",{with:function(t,e){var r=wa(this),n=ga(t),o=va(r)?ba(e):+e;return da(r,ma(r),n,o)}}.with,!Oa);var Ta=function(t){return t[t.NewLine=10]="NewLine",t[t.CarriageReturn=13]="CarriageReturn",t[t.Space=32]="Space",t[t.Colon=58]="Colon",t}(Ta||{});const Aa="text/event-stream";class Ca extends EventTarget{CONNECTING=0;OPEN=1;CLOSED=2;readyState=this.CONNECTING;onerror=null;onmessage=null;onopen=null;onRetryDelayReceived=null;constructor(t,e){super(),this.url=t instanceof URL?t.toString():t,this.options=e??{},this.retry=e?.retry??5e3,this.connect()}get withCredentials(){return this.options.withCredentials??!1}get retryDelay(){return this.retry}async connect(t){try{this.abortController=new AbortController,this.readyState=this.CONNECTING;const e={...this.options,headers:t?{...this.options.headers,Accept:Aa,"Last-Event-ID":t}:{...this.options.headers,Accept:Aa},cache:"no-store",credentials:this.withCredentials?"include":"omit",signal:this.abortController?.signal},r=await globalThis.fetch(this.url,e);if(200!==r.status)return this.failConnection(`Request failed with status code ${r.status}`);if(!r.headers.get("Content-Type")?.includes(Aa))return this.failConnection(`Request failed with wrong content type '${r.headers.get("Content-Type")}'`);if(!r?.body)return this.failConnection("Request failed with empty response body'");this.announceConnection();const n=r.body.getReader(),o=Ea(),i=function(){let t;const e=new TextDecoder;return function*(r,n){if(0===r.length)t&&(yield[t]),t={data:"",event:"",id:"",retry:void 0};else if(n>0){const o=e.decode(r.subarray(0,n)),i=n+(r[n+1]===Ta.Space?2:1),a=e.decode(r.subarray(i));switch(t??={data:"",event:"",id:"",retry:void 0},o){case"data":t.data=t.data?t.data+"\n"+a:a;break;case"event":t.event=a;break;case"id":t.id=a,yield[void 0,a,void 0];break;case"retry":const e=parseInt(a,10);isNaN(e)||(t.retry=e,yield[void 0,void 0,e])}}}}();for await(const t of async function*(t){let e=await t.read();for(;!e.done;)yield e.value,e=await t.read()}(n))for await(const[e,n]of o(t))for await(const[t,o,a]of i(e,n))void 0!==o?this.currentLastEventId=o:void 0!==a?(this.retry=a,this.onRetryDelayReceived?.(a)):t&&this.dispatchMessage(t,this.currentLastEventId,r.url)}catch(t){if("object"==typeof t&&"AbortError"===t?.name)return;return void await this.reconnect("Reconnecting EventSource because of error",t)}await this.reconnect("Reconnecting because EventSource connection closed")}async reconnect(t,e){const r=new Event("error");this.dispatchEvent(r),this.onerror?.(r),e&&console.warn("Error occurred in EventSource",e??""),this.readyState===this.CLOSED||this.options.disableRetry||(t&&console.warn(t,e??""),setTimeout((async()=>{await this.connect(this.currentLastEventId)}),this.retry))}dispatchMessage(t,e,r){const n=r&&URL.canParse(r)?new URL(r):void 0,o=t?.event?t.event:"message",i=new MessageEvent(o,{data:t?.data,lastEventId:t?.id||e,origin:n?.origin});this.dispatchEvent(i),"message"===o&&this.onmessage?.(i)}failConnection(t){console.error("Fatal error occurred in EventSource",t),this.readyState=this.CLOSED;const e=new Event("error");this.dispatchEvent(e),this.onerror?.(e)}announceConnection(){console.debug("Connection established"),this.readyState=this.OPEN;const t=new Event("open");this.dispatchEvent(t),this.onopen?.(t)}close(){this.readyState=this.CLOSED,this.abortController?.abort()}addEventListener(t,e,r){super.addEventListener(t,e,r)}removeEventListener(t,e,r){super.removeEventListener(t,e,r)}}var Pa=function(e){function i(t,r){var n=e.call(this,t,r)||this;return n.plugin=r,n}return r(i,e),i.prototype.display=function(){var e=this,r=this.containerEl;r.empty(),new t.Setting(r).setName("noteGPT Settings").setDesc("OpenAI API Key").addText((function(t){return t.setPlaceholder("Enter your API Key").setValue(e.plugin.settings.apiKey).onChange((function(t){return n(e,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return this.plugin.settings.apiKey=t,[4,this.plugin.saveSettings()];case 1:return e.sent(),[2]}}))}))}))}))},i}(t.PluginSettingTab),ja={apiKey:"default"},Ra=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.fileContent="",t.firstMessage=!0,t}return r(i,e),i.prototype.onload=function(){return n(this,void 0,void 0,(function(){var t=this;return o(this,(function(e){switch(e.label){case 0:return[4,this.loadSettings()];case 1:return e.sent(),this.addCommand({id:"call-gpt-completions",name:"Generate Text with GPT",callback:function(){return n(t,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return this.messages=[{role:"system",content:"You are a helpful assistant"},{role:"user",content:"Write me a Haiku"}],[4,this.callChatGPTStream(this.messages)];case 1:return t.sent(),[2]}}))}))}}),this.addSettingTab(new Pa(this.app,this)),this.registerInterval(window.setInterval((function(){return console.log("setInterval")}),3e5)),[2]}}))}))},i.prototype.onunload=function(){},i.prototype.callChatGPTStream=function(t){return n(this,void 0,void 0,(function(){var e,r,i,a,c=this;return o(this,(function(u){return(e=this.settings.apiKey)?(r={"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},i={model:"gpt-4-turbo-preview",messages:t,stream:!0},(a=new Ca("https://api.openai.com/v1/chat/completions",{method:"POST",headers:r,body:JSON.stringify(i)})).onmessage=function(t){return n(c,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.handleChunk(t.data)];case 1:return e.sent(),this.setCursorToEndOfFile(),[3,3];case 2:return e.sent(),a.close(),[3,3];case 3:return[2]}}))}))},a.onerror=function(t){return n(c,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,a.close()];case 1:return e.sent(),console.error("Error occurred:",t),[2]}}))}))},[2]):(console.log("No OpenAI API Key set"),[2])}))}))},i.prototype.handleChunk=function(t){return n(this,void 0,void 0,(function(){var e,r,n,i,a;return o(this,(function(o){switch(o.label){case 0:if(e="## Assistant:\n\n",r="\n\n<hr>\n\n## User:\n\n","[DONE]"===t)return[3,6];o.label=1;case 1:return o.trys.push([1,4,,5]),n=JSON.parse(t),(i=n.choices[0].delta.content)?(this.firstMessage&&(i=e+i,this.firstMessage=!1),[4,this.appendTextToActiveFile(i)]):[3,3];case 2:o.sent(),o.label=3;case 3:return[3,5];case 4:return a=o.sent(),console.error("Error parsing JSON:",a),[3,5];case 5:return[3,8];case 6:return[4,this.appendTextToActiveFile(r)];case 7:throw o.sent(),this.setCursorToEndOfFile(),this.firstMessage=!0,new Error("Stream ended with [DONE]");case 8:return[2]}}))}))},i.prototype.setCursorToEndOfFile=function(){var t,e=null===(t=this.app.workspace.activeEditor)||void 0===t?void 0:t.editor;if(e){var r=e.lineCount()-1,n=e.getLine(r).length;e.setCursor({line:r,ch:n})}},i.prototype.appendTextToActiveFile=function(e){return n(this,void 0,void 0,(function(){var r,n;return o(this,(function(o){switch(o.label){case 0:return[4,this.app.workspace.getActiveFile()];case 1:return(r=o.sent())?""!=this.fileContent?[3,3]:(n=this,[4,this.app.vault.read(r)]):(new t.Notice("No active file"),[2]);case 2:n.fileContent=o.sent(),o.label=3;case 3:return this.fileContent+=e,[4,this.app.vault.modify(r,this.fileContent)];case 4:return o.sent(),[2]}}))}))},i.prototype.loadSettings=function(){return n(this,void 0,void 0,(function(){var t,e,r,n;return o(this,(function(o){switch(o.label){case 0:return t=this,r=(e=Object).assign,n=[{},ja],[4,this.loadData()];case 1:return t.settings=r.apply(e,n.concat([o.sent()])),[2]}}))}))},i.prototype.saveSettings=function(){return n(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this.saveData(this.settings)];case 1:return t.sent(),[2]}}))}))},i}(t.Plugin);module.exports=Ra;
//# sourceMappingURL=main.js.map
